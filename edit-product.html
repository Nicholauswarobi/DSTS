<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Product</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <h1>Edit Product</h1>
    </header>

    <nav>
        <ul>
            <li><a href="dsts.html">Dashboard</a></li>
            <li><a href="inventory.html">Inventory Updates</a></li>
            <li><a href="expenses.html">Expanses</a></li>
            <li><a href="financial.html">Financial Tracking</a></li>
        </ul>
    </nav>

    <main>
        <form class="form-container" id="editProductForm">
            <label for="productName">Product Name:</label>
            <input type="text" id="productName" readonly>

            <label for="productQuantity">Quantity:</label>
            <input type="number" id="productQuantity" required>

            <label for="productPrice">Price:</label>
            <input type="number" id="productPrice" step="0.01" required>

            <label for="productPurchase">Purchase:</label> <!-- New Purchase Field -->
            <input type="number" id="productPurchase" step="0.01" required>

            <button type="submit">Save Changes</button>
        </form>
    </main>

    <script>
        // Populate form fields with query parameters
        const urlParams = new URLSearchParams(window.location.search);
        document.getElementById('productName').value = urlParams.get('productName');
        document.getElementById('productQuantity').value = urlParams.get('quantity');
        document.getElementById('productPrice').value = urlParams.get('price');
        document.getElementById('productPurchase').value = urlParams.get('purchase'); // Pre-fill the Purchase field

        // Handle Edit Product form submission
        document.getElementById('editProductForm').addEventListener('submit', (e) => {
            e.preventDefault();

            const productName = document.getElementById('productName').value;
            const productQuantity = parseInt(document.getElementById('productQuantity').value, 10);
            const productPrice = parseFloat(document.getElementById('productPrice').value);
            const productPurchase = parseFloat(document.getElementById('productPurchase').value); // New Purchase Field

            if (!productName || productQuantity <= 0 || isNaN(productPrice) || isNaN(productPurchase)) {
                alert('Please fill out all fields correctly.');
                return;
            }

            // Update product in localStorage
            const products = JSON.parse(localStorage.getItem('products')) || [];
            const productIndex = products.findIndex((product) => product.productName === productName);

            if (productIndex !== -1) {
                products[productIndex] = {
                    productName,
                    productQuantity,
                    productPrice,
                    productPurchase, // Save Purchase Field
                    dateAdded: products[productIndex].dateAdded, // Keep original date
                };
                localStorage.setItem('products', JSON.stringify(products));
                alert('Product updated successfully!');
                window.location.href = 'inventory.html';
            } else {
                alert('Product not found!');
            }
        });
    </script>
</body>
</html>